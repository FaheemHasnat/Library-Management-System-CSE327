{% extends "base.html" %}

{% block title %}Book Return - Library Management System{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">
{% endblock %}

{% block content %}
<div class="admin-wrapper">
    <header class="admin-header">
        <div class="container">
            <nav class="admin-nav">
                <a href="{{ url_for('librarian_dashboard') }}" class="admin-logo">
                    <div class="admin-logo-icon">LMS</div>
                    Library Management System
                </a>
                
                <div class="admin-user">
                    <div class="admin-user-info">
                        <div class="admin-user-name">{{ user_name }}</div>
                        <div class="admin-user-role">Librarian</div>
                    </div>
                    <a href="{{ url_for('logout') }}" class="admin-logout-btn">Logout</a>
                </div>
            </nav>
        </div>
    </header>

    <main class="admin-main">
        <div class="container">
            <div class="admin-content">
                <div class="breadcrumb">
                    <a href="{{ url_for('librarian_dashboard') }}">Dashboard</a> > Book Return
                </div>

                <div class="content-section">
                    <h1>üì• Book Return</h1>
                    <p>Process book returns from students</p>
                    <a href="{{ url_for('librarian_dashboard') }}" class="btn btn-outline" style="margin-bottom: 1.5rem;">
                        ‚Üê Back to Dashboard
                    </a>
                </div>

                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ category }}">{{ message }}</div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                <section class="admin-quick-nav">
                    <h2 class="admin-quick-nav-title">Currently Issued Books</h2>
                    {% if issued_books %}
                        <div class="issued-books-grid">
                            {% for book in issued_books %}
                            <div class="issued-book-card">
                                <div class="book-info">
                                    <h3>{{ book.title }}</h3>
                                    <p><strong>Author:</strong> {{ book.author }}</p>
                                    <p><strong>ISBN:</strong> {{ book.isbn }}</p>
                                    <p><strong>Book ID:</strong> {{ book.book_id }}</p>
                                </div>
                                
                                <div class="student-info">
                                    <h4>Issued To:</h4>
                                    <p><strong>{{ book.student_name }}</strong></p>
                                    <p>{{ book.student_email }}</p>
                                    <p><strong>Student ID:</strong> {{ book.UserID }}</p>
                                </div>
                                
                                <div class="date-info">
                                    <p><strong>Issue Date:</strong> {{ book.issue_date }}</p>
                                    <p><strong>Due Date:</strong> 
                                        <span class="due-date {% if book.due_date < today %}overdue{% endif %}">
                                            {{ book.due_date }}
                                        </span>
                                    </p>
                                </div>
                                
                                <form method="POST" class="return-form">
                                    <input type="hidden" name="user_id" value="{{ book.UserID }}">
                                    <input type="hidden" name="book_id" value="{{ book.book_id }}">
                                    
                                    <div class="form-group">
                                        <label class="form-label">Return Date:</label>
                                        <input type="date" name="return_date" class="form-control" 
                                               value="{{ today }}" max="{{ today }}" required>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-success">
                                        üì• Mark as Returned
                                    </button>
                                </form>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="empty-state">
                            <p>No books are currently issued</p>
                        </div>
                    {% endif %}
                </section>
            </div>
        </div>
    </main>
</div>

<style>
.issued-books-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 1.5rem;
    margin-top: 1rem;
}

.issued-book-card {
    background: var(--background-secondary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: 1.5rem;
    transition: box-shadow 0.3s ease;
}

.issued-book-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.book-info h3 {
    color: var(--primary-color);
    margin-bottom: 0.5rem;
    font-size: 1.1rem;
}

.student-info {
    margin: 1rem 0;
    padding: 1rem;
    background: var(--background-primary);
    border-radius: var(--radius-md);
}

.student-info h4 {
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.date-info {
    margin: 1rem 0;
}

.due-date.overdue {
    color: var(--danger-color);
    font-weight: bold;
}

.return-form {
    border-top: 1px solid var(--border-color);
    padding-top: 1rem;
}

.return-form .form-group {
    margin-bottom: 1rem;
}

.empty-state {
    text-align: center;
    padding: 3rem;
    color: var(--text-secondary);
    font-style: italic;
}

.alert {
    padding: 1rem;
    border-radius: var(--radius-md);
    margin-bottom: 1rem;
}

.alert-success {
    background-color: #d4edda;
    color: #155724;
    border: 1px solid #c3e6cb;
}

.alert-warning {
    background-color: #fff3cd;
    color: #856404;
    border: 1px solid #ffeaa7;
}

.alert-error {
    background-color: #f8d7da;
    color: #721c24;
    border: 1px solid #f5c6cb;
}
</style>
{% endblock %}
