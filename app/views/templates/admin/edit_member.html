{% extends "base.html" %}

{% block title %}Edit Member - Admin Dashboard{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin_dashboard.css') }}">
<link rel="stylesheet" href="{{ url_for('static', filename='css/auth.css') }}">
{% endblock %}

{% block content %}
<div class="admin-wrapper">
    <header class="admin-header">
        <div class="container">
            <nav class="admin-nav">
                <a href="{{ url_for('admin_dashboard') }}" class="admin-logo">
                    <div class="admin-logo-icon">LMS</div>
                    Library Management System
                </a>
                
                <div class="admin-user">
                    <div class="admin-user-info">
                        <div class="admin-user-name">{{ user_name }}</div>
                        <div class="admin-user-role">Administrator</div>
                    </div>
                    <a href="{{ url_for('logout') }}" class="admin-logout-btn">Logout</a>
                </div>
            </nav>
        </div>
    </header>

    <main class="admin-main">
        <div class="container">
            <div class="admin-content">
                <section class="admin-welcome">
                    <h1 class="admin-welcome-title">‚úèÔ∏è Edit Member</h1>
                    <p class="admin-welcome-subtitle">Search and edit member information</p>
                </section>

                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="alert alert-{{ 'error' if category == 'error' else category }}">
                                {{ message }}
                            </div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}

                {% if not member %}
                <section class="admin-notifications" style="max-width: 600px; margin: 0 auto;">
                    <h3 class="admin-notifications-title">
                        <div class="admin-notifications-icon">üîç</div>
                        Search Member
                    </h3>
                    <form method="POST" class="auth-form">
                        <div class="form-group-auth">
                            <input 
                                type="email" 
                                id="email" 
                                name="email" 
                                class="form-control-auth" 
                                placeholder="Enter member's email address"
                                required
                                value="{{ request.form.email if request.form.email }}"
                            >
                        </div>

                        <button type="submit" class="btn-auth">
                            Find Member
                        </button>
                    </form>
                </section>
                {% else %}
                <section class="admin-notifications" style="max-width: 600px; margin: 0 auto;">
                    <h3 class="admin-notifications-title">
                        <div class="admin-notifications-icon">‚úèÔ∏è</div>
                        Edit Member Information
                    </h3>
                    <form method="POST" class="auth-form">
                        <input type="hidden" name="user_id" value="{{ member.user_id }}">
                        <input type="hidden" name="action" value="update">
                        
                        <div class="form-group-auth">
                            <input 
                                type="text" 
                                id="name" 
                                name="name" 
                                class="form-control-auth" 
                                placeholder="Enter full name"
                                required
                                value="{{ member.name }}"
                            >
                        </div>

                        <div class="form-group-auth">
                            <input 
                                type="email" 
                                id="email" 
                                name="email" 
                                class="form-control-auth" 
                                placeholder="Email address (cannot be changed)"
                                readonly
                                style="background-color: #f5f5f5; cursor: not-allowed;"
                                value="{{ member.email }}"
                            >
                            <small style="color: #666; font-size: 12px; margin-top: 5px; display: block;">Email cannot be modified for security reasons</small>
                        </div>

                        <div class="form-group-auth">
                            <select 
                                id="role" 
                                name="role" 
                                class="form-control-auth" 
                                required
                            >
                                <option value="Student" {{ 'selected' if member.role == 'Student' }}>Student</option>
                                <option value="Librarian" {{ 'selected' if member.role == 'Librarian' }}>Librarian</option>
                            </select>
                        </div>
                        </div>

                        <div class="form-group-auth">
                            <input 
                                type="password" 
                                id="new_password" 
                                name="new_password" 
                                class="form-control-auth" 
                                placeholder="Enter new password (leave blank to keep current)"
                                minlength="6"
                            >
                        </div>

                        <button type="submit" class="btn-auth">
                            Update Member
                        </button>
                    </form>
                </section>
                {% endif %}
            </div>
        </div>
    </main>
</div>
{% endblock %}
